(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{169:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(68),i=n.n(o),c=(n(79),n(3)),l=n(4),s=n(6),u=n(5),m=n(7),d=n(172),p=n(171),f=(n(81),n(2)),h=n(9),v=n(16),g=(n(83),n(18)),b=r.a.createContext(),y=function(e){return function(t){return r.a.createElement(b.Consumer,null,function(n){return r.a.createElement(e,Object.assign({},t,{user:n}))})}},E=Symbol(),O=Symbol(),j=Symbol(),k=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={token:null,status:E,login:n.login.bind(Object(g.a)(Object(g.a)(n)))},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("token");t&&fetch("/account",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then(k).then(function(n){var a=n.exp;new Date<new Date(1e3*a)&&e.setState({token:t,status:O})})}},{key:"login",value:function(e){var t=this;fetch("/login",{method:"POST",body:JSON.stringify({password:e}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(k).then(function(e){var n=e.token;t.setState({token:n,status:O}),localStorage.setItem("token",n)}).catch(function(){return t.setState({status:j})})}},{key:"render",value:function(){return r.a.createElement(b.Provider,{value:this.state},this.props.children)}}]),t}(r.a.Component),x=n(170),S=function(e){var t=e.seen,n=e.onClick;return r.a.createElement("i",{className:"fas fa-eye",style:{color:t?"var(--success)":"black",cursor:"pointer"},onClick:n})},N=function(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}},w=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},I=function(e,t){return fetch("/api/movies/".concat(e._id),{method:"PUT",body:JSON.stringify(e),headers:N(t)}).then(w)},A=y(function(e){var t=e.movie,n=e.onEdit,a=e.user,o=e.onChange,i=e.onDelete,c=function(e,n){return function(){return I(Object(f.a)({},t,Object(v.a)({},e,n)),a).then(o)}},l="".concat(t.title),s="".concat(t.productionYear," - ").concat(t.genre.join(","));return r.a.createElement("div",{className:"card movie-card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},r.a.createElement(x.a,{to:"movie/".concat(t._id)},r.a.createElement("div",{className:"ellipsis",title:l},l))),r.a.createElement("h6",{className:"card-subtitle mb-2 text-muted ellipsis",title:s},s),r.a.createElement("div",{className:"movie-card-actions",style:{position:"absolute",top:2,right:4}},r.a.createElement("i",{className:"fab fa-neos",style:{cursor:"pointer",color:t.netflix?"var(--danger)":"black"},onClick:c("netflix",!t.netflix)}),"Film"===t.type?r.a.createElement(S,{seen:t.seen,onClick:c("seen",!t.seen)}):void 0,r.a.createElement("i",{className:"fas fa-pencil-alt",onClick:n,style:{cursor:"pointer"}}),r.a.createElement("i",{className:"fas fa-ban",style:{cursor:"pointer",color:t.finished?"#fecc00":"black"},onClick:c("finished",!t.finished)}),r.a.createElement("i",{className:"fas fa-trash",onClick:function(){window.confirm()&&function(e,t){fetch("/api/movies/".concat(e._id),{method:"DELETE",headers:N(t)}).then(w)}(t,a).then(i)},style:{cursor:"pointer"}})),r.a.createElement("div",{className:"poster text-center"},r.a.createElement("img",{src:t.fileUrl,alt:"movie poster"}))))}),T=n(10),R=n.n(T),F=r.a.createContext(),P=Symbol(),B=Symbol(),D=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={genres:[],types:[],status:P},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t={headers:{Authorization:"Bearer ".concat(this.props.token)}},n=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")};Promise.all([fetch("/api/movies/genre",t).then(n),fetch("/api/movies/type",t).then(n)]).then(function(t){var n=Object(h.a)(t,2),a=n[0],r=n[1];e.setState({genres:a,types:r,status:B})})}},{key:"render",value:function(){return r.a.createElement(F.Provider,{value:this.state},this.props.children)}}]),t}(r.a.Component),W=n(17),Y=n(69),_=n.n(Y),L=r.a.createContext(),U=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).add=function(e){n.setState({movies:[e].concat(Object(W.a)(n.state.movies))})},n.update=function(e,t){var a=_()(n.state.movies,["_id",e]),r=Object(W.a)(n.state.movies);r[a]=t,n.setState({movies:r.filter(Boolean)})},n.addAll=function(e){var t=e.data,a=e.count;n.setState({movies:Object(W.a)(n.state.movies).concat(Object(W.a)(t)),count:a})},n.invalidate=function(){n.setState({movies:[]})},n.onChange=function(e){return function(t){n.invalidate(),n.setState(function(n){var a=n.filters;return{filters:Object(f.a)({},a,Object(v.a)({},e,t||""))}})}},n.state={movies:[],count:0,filters:{productionYear:"",title:"",genres:[],types:[],seen:!1,unseen:!1,limit:30},onChange:n.onChange,addAll:n.addAll,update:n.update,add:n.add,invalidate:n.invalidate},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(L.Provider,{value:this.state},this.props.children)}}]),t}(r.a.Component),z=n(12),H=n.n(z),M=n(21),J=n(15),G=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={selectedItems:n.props.selectedItems||[]},n.stateReducer=function(e,t){switch(t.type){case J.a.stateChangeTypes.keyDownEnter:case J.a.stateChangeTypes.clickItem:return Object(f.a)({},t,{highlightedIndex:e.highlightedIndex,isOpen:!0});default:return t}},n.callOnChange=function(e){return function(){n.props.onChange&&n.props.onChange(n.state.selectedItems,n.getStateAndHelpers(e))}},n.handleSelection=function(e,t){n.state.selectedItems.includes(e)?n.removeItem(e,n.callOnChange(t)):n.addSelectedItem(e,n.callOnChange(t))},n.removeItem=function(e,t){n.setState(function(t){return{selectedItems:t.selectedItems.filter(function(t){return t!==e})}},t)},n.getRemoveButtonProps=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick,r=t.item,o=Object(M.a)(t,["onClick","item"]);return Object(f.a)({onClick:function(t){a&&a(t),t.stopPropagation(),n.removeItem(r,n.callOnChange(e))}},o)}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){e.selectedItems!==this.props.selectedItems&&this.props.selectedItems!==this.state.selectedItems&&this.setState({selectedItems:this.props.selectedItems||[]})}},{key:"addSelectedItem",value:function(e,t){this.setState(function(t){var n=t.selectedItems;return{selectedItems:Object(W.a)(n).concat([e])}},t)}},{key:"getStateAndHelpers",value:function(e){var t=this.state.selectedItems,n=this.getRemoveButtonProps,a=this.removeItem;return Object(f.a)({getRemoveButtonProps:n(e),removeItem:a,selectedItems:t},e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.render,a=t.children,o=void 0===a?n:a,i=Object(M.a)(t,["render","children"]);return r.a.createElement(J.a,Object.assign({},i,{stateReducer:this.stateReducer,onChange:this.handleSelection,selectedItem:null}),function(t){return o(e.getStateAndHelpers(t))})}}]),t}(r.a.Component),K=n(20),X=n(37),V=function(){return{className:K.css.apply(void 0,arguments)}},q=Object(X.a)("li")({position:"relative",cursor:"pointer",display:"block",border:"none",height:"auto",textAlign:"left",borderTop:"none",lineHeight:"1em",color:"rgba(0,0,0,.87)",fontSize:"1rem",textTransform:"none",fontWeight:"400",boxShadow:"none",padding:".8rem 1.1rem",whiteSpace:"normal",wordWrap:"normal"},function(e){var t=e.isActive,n=e.isSelected,a=[];return t&&a.push({color:"rgba(0,0,0,.95)",background:"rgba(0,0,0,.03)"}),n&&a.push({color:"rgba(0,0,0,.95)",fontWeight:"700"}),a}),Q=Object(X.a)("ul")({padding:0,marginTop:0,position:"absolute",backgroundColor:"white",width:"100%",maxHeight:"20rem",overflowY:"auto",overflowX:"hidden",outline:"0",transition:"opacity .1s ease",borderRadius:"0 0 .28571429rem .28571429rem",boxShadow:"0 2px 3px 0 rgba(34,36,38,.15)",borderColor:"#96c8da",borderTopWidth:"0",borderRightWidth:1,borderBottomWidth:1,borderLeftWidth:1,borderStyle:"solid",zIndex:10},function(e){return{border:e.isOpen?null:"none"}}),Z=r.a.forwardRef(function(e,t){return r.a.createElement(Q,Object.assign({innerRef:t},e))}),ee=Object(X.a)("button")({backgroundColor:"transparent",border:"none",position:"absolute",right:0,top:0,cursor:"pointer",width:47,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",alignItems:"center"});function te(e){var t=e.isOpen;return r.a.createElement("svg",{viewBox:"0 0 20 20",preserveAspectRatio:"none",width:16,fill:"transparent",stroke:"#979797",strokeWidth:"1.1px",transform:t?"rotate(180)":null},r.a.createElement("path",{d:"M1,6 L10,15 L19,6"}))}var ne,ae=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={selectedItems:n.props.selectedItems||[]},n.stateReducer=function(e,t){switch(t.type){case J.a.stateChangeTypes.keyDownEnter:case J.a.stateChangeTypes.clickItem:return Object(f.a)({},t,{highlightedIndex:e.highlightedIndex,isOpen:!0});default:return t}},n.callOnChange=function(e){return function(){n.props.onChange&&n.props.onChange(n.state.selectedItems,n.getStateAndHelpers(e))}},n.handleSelection=function(e,t){n.state.selectedItems.filter(function(t){return e===t[0]}).length>0?n.removeItem([e],n.callOnChange(t)):n.addSelectedItem(e,n.callOnChange(t))},n.removeItem=function(e,t){n.setState(function(t){return{selectedItems:t.selectedItems.filter(function(t){return t[0]!==e[0]})}},t)},n.getRemoveButtonProps=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick,r=t.item,o=Object(M.a)(t,["onClick","item"]);return Object(f.a)({onClick:function(t){a&&a(t),t.stopPropagation(),n.removeItem(r,n.callOnChange(e))}},o)}},n.clickOnItem=function(e){return function(t,a){n.setState(function(e){var n=e.selectedItems;return n[a]=[t[0],!t[1]],{selectedItems:n.filter(function(e){return e!==t[0]})}},n.callOnChange(e))}},n.displayItem=function(e){return e[0]},n.displayBackground=function(e){return e[1]?"#ccc":"tomato"},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"addSelectedItem",value:function(e,t){this.setState(function(t){var n=t.selectedItems;return{selectedItems:Object(W.a)(n).concat([[e,!0]])}},t)}},{key:"getStateAndHelpers",value:function(e){var t=this.state.selectedItems,n=this.getRemoveButtonProps,a=this.removeItem,r=this.clickOnItem,o=this.displayItem,i=this.displayBackground;return Object(f.a)({getRemoveButtonProps:n(e),removeItem:a,selectedItems:t,clickOnItem:r(e),displayItem:o,displayBackground:i},e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.render,a=t.children,o=void 0===a?n:a,i=Object(M.a)(t,["render","children"]);return r.a.createElement(J.a,Object.assign({},i,{stateReducer:this.stateReducer,onChange:this.handleSelection,selectedItem:null}),function(t){return o(e.getStateAndHelpers(t))})}}]),t}(r.a.Component),re=function(e){return function(t){function n(e){var t;return Object(c.a)(this,n),(t=Object(s.a)(this,Object(u.a)(n).call(this,e))).input=r.a.createRef(),t}return Object(m.a)(n,t),Object(l.a)(n,[{key:"render",value:function(){var t=this,n=this.props,a=n.handleChange,o=n.placeholder,i=n.items,c=n.selectedItems;return r.a.createElement(e,{onChange:a,selectedItems:c},function(e){var n=e.getInputProps,a=e.getToggleButtonProps,c=e.getMenuProps,l=e.getRemoveButtonProps,s=e.removeItem,u=e.isOpen,m=e.inputValue,d=e.selectedItems,p=e.getItemProps,h=e.highlightedIndex,v=e.toggleMenu,g=e.clickOnItem,b=void 0===g?function(){}:g,y=e.displayItem,E=void 0===y?H.a:y,O=e.displayBackground,j=void 0===O?function(){return"#ccc"}:O;return r.a.createElement("div",{style:{margin:"auto",position:"relative"}},r.a.createElement("div",Object.assign({},V({cursor:"pointer",position:"relative",borderRadius:"6px",borderTopRadius:6,borderBottomRightRadius:u?0:6,borderBottomLeftRadius:u?0:6,padding:10,paddingRight:50,boxShadow:"0 2px 3px 0 rgba(34,36,38,.15)",borderColor:"#96c8da",borderTopWidth:"1",borderRightWidth:1,borderBottomWidth:1,borderLeftWidth:1,borderStyle:"solid"}),{onClick:function(){v(),!u&&t.input.current.focus()}}),r.a.createElement("div",V({display:"flex",flexWrap:"wrap",alignItems:"center"}),d.length>0?d.map(function(e,t){return r.a.createElement("div",Object.assign({key:t},V({margin:2,paddingTop:2,paddingBottom:2,paddingLeft:8,paddingRight:8,display:"inline-block",wordWrap:"none",backgroundColor:j(e),borderRadius:2}),{onClick:function(n){n.preventDefault(),n.stopPropagation(),b(e,t)}}),r.a.createElement("div",V({display:"grid",gridGap:6,gridAutoFlow:"column",alignItems:"center"}),r.a.createElement("span",null,E(e)),r.a.createElement("button",Object.assign({},l({item:e}),V({cursor:"pointer",lineHeight:.8,border:"none",backgroundColor:"transparent",padding:"0",fontSize:"16px"}),{type:"button"}),"\ud835\ude05")))}):o,r.a.createElement("input",n(Object(f.a)({ref:t.input,onKeyUp:function(e){"Backspace"!==e.key||m||s(d[d.length-1])}},V({border:"none",marginLeft:6,flex:1,fontSize:14,minHeight:27}))))),r.a.createElement(ee,a({onClick:function(e){e.stopPropagation()}}),r.a.createElement(te,{isOpen:u}))),r.a.createElement(Z,c({isOpen:u}),u?i.map(function(e,t){return r.a.createElement(q,Object.assign({key:t},p({item:e,index:t,isActive:h===t,isSelected:d.includes(e)})),e)}):null))})}}]),n}(a.Component)},oe=re(G),ie=re(ae),ce=function(e){return e.target.value},le=function(e,t){var n=e.filters,a=e.onChange,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ce;return{value:n[t],onChange:function(e){return a(t)(r(o(e)))}}},se=function(){var e=Object(a.useContext)(L),t=e.filters,n=e.onChange,o=Object(a.useContext)(F),i=o.genres,c=o.types,l=t.seen,s=t.unseen,u=t.netflix,m=t.unnetflix;return r.a.createElement("form",{className:"form-inline movies-filter"},r.a.createElement("div",{className:"form-group mx-sm-3"},r.a.createElement("input",Object.assign({},le({filters:t,onChange:n},"productionYear",function(e){return parseInt(e,10)}),{type:"number",max:2200,placeholder:"YYYY",className:"form-control",style:{width:"90px"}}))),r.a.createElement("div",{className:"form-group mx-sm-3"},r.a.createElement("input",Object.assign({type:"text"},le({filters:t,onChange:n},"title"),{placeholder:"Title",className:"form-control"}))),r.a.createElement("div",{className:"form-group mx-sm-3",style:{maxWidth:"300px"}},r.a.createElement(ie,{placeholder:"Genre",handleChange:le({filters:t,onChange:n},"genres",H.a,H.a).onChange,items:i})),r.a.createElement("div",{className:"form-group mx-sm-3",style:{maxWidth:"300px"}},r.a.createElement(oe,{placeholder:"Type",handleChange:le({filters:t,onChange:n},"types",H.a,H.a).onChange,items:c})),r.a.createElement("div",{className:"form-group mx-sm-3"},r.a.createElement("i",{className:"fas fa-eye",style:{color:l?"var(--success)":"",cursor:"pointer"},onClick:function(){return n("seen")(!l)}}),r.a.createElement("i",{className:"fas fa-eye-slash",style:{color:s?"var(--success)":"",cursor:"pointer"},onClick:function(){return n("unseen")(!s)}})),r.a.createElement("div",{className:"form-group mx-sm-3"},r.a.createElement("span",{className:"fa-stack fa-1g",onClick:function(){return n("netflix")(!u)},style:{cursor:"pointer"}},r.a.createElement("i",{className:"far fa-circle fa-stack-2x",style:{color:u?"var(--danger)":"black"}}),r.a.createElement("i",{className:"fab fa-neos fa-stack-1x"})),r.a.createElement("span",{className:"fa-stack fa-1g",onClick:function(){return n("unnetflix")(!m)},style:{cursor:"pointer"}},r.a.createElement("i",{className:"fas fa-ban fa-stack-2x",style:{color:m?"var(--danger)":"black"}}),r.a.createElement("i",{className:"fab fa-neos fa-stack-1x"}))))},ue=n(33),me=n.n(ue),de=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.placeholder,a=e.items,o=e.selectedItem;return r.a.createElement(J.a,{onChange:t,selectedItem:o},function(e){e.getInputProps;var t=e.getItemProps,o=(e.getLabelProps,e.getMenuProps),i=e.isOpen,c=(e.inputValue,e.highlightedIndex),l=e.selectedItem,s=e.toggleMenu;return r.a.createElement("div",{style:{margin:"auto",position:"relative"}},r.a.createElement("div",Object.assign({},V({cursor:"pointer",position:"relative",borderRadius:"6px",borderTopRadius:6,borderBottomRightRadius:i?0:6,borderBottomLeftRadius:i?0:6,padding:10,paddingRight:50,boxShadow:"0 2px 3px 0 rgba(34,36,38,.15)",borderColor:"#96c8da",borderTopWidth:"1",borderRightWidth:1,borderBottomWidth:1,borderLeftWidth:1,borderStyle:"solid"}),{onClick:function(){s()}}),r.a.createElement("div",V({display:"flex",flexWrap:"wrap",alignItems:"center"}),l?r.a.createElement("div",V({margin:2,paddingTop:2,paddingBottom:2,paddingLeft:8,paddingRight:8,display:"inline-block",wordWrap:"none",backgroundColor:"#ccc",borderRadius:2}),r.a.createElement("div",V({display:"grid",gridGap:6,gridAutoFlow:"column",alignItems:"center"}),r.a.createElement("span",null,l))):n),r.a.createElement(ee,null,r.a.createElement(te,{isOpen:i}))),r.a.createElement(Z,o({isOpen:i}),i?a.map(function(e,n){return r.a.createElement(q,Object.assign({key:n},t({item:e,index:n,isActive:c===n,isSelected:l===e})),e)}):null))})}}]),t}(r.a.Component),pe=n(45),fe=n.n(pe),he=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={open:!1,toggle:n.toggle.bind(Object(g.a)(Object(g.a)(n)))},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({open:!this.state.open})}},{key:"render",value:function(){return r.a.createElement(a.Fragment,null,this.props.children(this.state))}}]),t}(a.Component),ve={movie:{title:"",genre:[],type:"",productionYear:"",summary:""},allocine:{movies:[],tvshows:[]}},ge=function(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}},be=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},ye=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).valid=function(){return!fe()(n.state.movie.title)&&n.state.movie.genre.length>0&&!fe()(n.state.movie.type)},n.add=function(){fetch("/api/movies",{method:"POST",body:JSON.stringify(n.state.movie),headers:ge(n.props.user)}).then(be).then(function(e){n.props.onAdd(Object(f.a)({},n.state.movie,e)),$("#movie-creator-updator").modal("hide")})},n.update=function(){fetch("/api/movies/".concat(n.props.movie._id),{method:"PUT",body:JSON.stringify(n.state.movie),headers:ge(n.props.user)}).then(be).then(function(e){n.props.onUpdate(Object(f.a)({},n.state.movie,e)),$("#movie-creator-updator").modal("hide")})},n.search=function(){Promise.all([fetch("/api/allocine?type=Film&title=".concat(n.state.movie.title),{headers:ge(n.props.user)}).then(be),fetch("/api/allocine?type=S\xe9rie&title=".concat(n.state.movie.title),{headers:ge(n.props.user)}).then(be)]).then(function(e){var t=Object(h.a)(e,2),a=t[0],r=t[1];return n.setState({allocine:{movies:a,tvshows:r}})})},n.synchronizeMovieAllocine=function(e){e===n.state.movie.idAllocine?n.setState({movie:Object(f.a)({},n.state.movie,{idAllocine:null})}):fetch("/api/allocine/movie/".concat(e),{headers:ge(n.props.user)}).then(be).then(function(t){var a=t.movie;return n.setState({movie:Object(f.a)({},n.state.movie,{idAllocine:e,title:a.title,genre:a.genre.map(function(e){return e.$}).sort(),type:"Film",productionYear:a.release&&a.release.releaseDate?new Date(a.release.releaseDate).getFullYear():a.productionYear,summary:a.synopsis,fileUrl:a.poster?a.poster.href:""})})})},n.synchronizeTvShowAllocine=function(e){e===n.state.movie.idAllocine?n.setState({movie:Object(f.a)({},n.state.movie,{idAllocine:null})}):fetch("/api/allocine/serie/".concat(e),{headers:ge(n.props.user)}).then(be).then(function(t){var a=t.tvseries;return n.setState({movie:Object(f.a)({},n.state.movie,{idAllocine:e,title:a.title,genre:a.genre.map(function(e){return e.$}).sort(),type:"S\xe9rie",productionYear:a.yearStart,summary:a.synopsis,fileUrl:a.poster?a.poster.href:""})})})},n.onInput=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return function(a){return n.setState({movie:Object(f.a)({},n.state.movie,Object(v.a)({},e,t(a.target.value)))})}},n.onSelect=function(e){return function(t){return n.setState({movie:Object(f.a)({},n.state.movie,Object(v.a)({},e,t))})}},n.state={movie:e.movie?e.movie:ve.movie,allocine:ve.allocine},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){$("#movie-creator-updator").on("hide.bs.modal",this.props.onClose)}},{key:"render",value:function(){var e=this,t=this.state.movie;return r.a.createElement(a.Fragment,null,this.props.application.status===P?r.a.createElement("div",null,"Loading..."):r.a.createElement("div",{className:"movie-modal modal fade movie-form",id:"movie-creator-updator",tabIndex:"-1",role:"dialog","data-show":"true"},r.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document"},r.a.createElement("div",{className:"modal-content"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("h5",{className:"modal-title"},t&&t.title||"New"),r.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),r.a.createElement("div",{className:"modal-body"},r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group col-11"},r.a.createElement("label",{htmlFor:"title"},"Title"),r.a.createElement("input",{type:"text",className:"form-control",id:"title","aria-describedby":"title",placeholder:"Enter title",onChange:this.onInput("title"),value:this.state.movie.title})),r.a.createElement("div",{className:"form-group col-1 text-center"},r.a.createElement("i",{className:"fab fa-angular fa-2x",style:{cursor:"pointer",color:"#fecc00",paddingTop:"35px"},onClick:this.search}))),this.state.allocine.movies.length>0?r.a.createElement(he,null,function(t){var n=t.open,o=t.toggle;return r.a.createElement(a.Fragment,null,r.a.createElement("div",{onClick:o,style:{cursor:"pointer"}},e.state.allocine.movies.length," movies",n?r.a.createElement("i",{className:"fas fa-chevron-up"}):r.a.createElement("i",{className:"fas fa-chevron-down"})),r.a.createElement("div",{className:"row",style:{overflowX:"scroll",display:n?"flex":"none",flexWrap:"nowrap"}},e.state.allocine.movies.map(function(t){return r.a.createElement("div",{key:t.code,className:"col-2 allocine-movie ".concat(t.code===e.state.movie.idAllocine?"selected":""),onClick:function(){return e.synchronizeMovieAllocine(t.code)}},t.code===e.state.movie.idAllocine?r.a.createElement("i",{className:"fas fa-check-circle selected-movie-icon fa-2x"}):null,r.a.createElement("div",null,t.title," -"," ",t.release&&t.release.releaseDate?new Date(t.release.releaseDate).getFullYear():t.productionYear),r.a.createElement("div",null,t.poster?r.a.createElement("img",{src:t.poster.href,alt:"movie poster",style:{width:"100%"}}):null))})))}):null,this.state.allocine.tvshows.length>0?r.a.createElement(he,null,function(t){var n=t.open,o=t.toggle;return r.a.createElement(a.Fragment,null,r.a.createElement("div",{onClick:o,style:{cursor:"pointer"}},e.state.allocine.tvshows.length," tv shows",n?r.a.createElement("i",{className:"fas fa-chevron-up"}):r.a.createElement("i",{className:"fas fa-chevron-down"})),r.a.createElement("div",{className:"row",style:{overflowX:"scroll",display:n?"flex":"none",flexWrap:"nowrap"}},e.state.allocine.tvshows.map(function(t){return r.a.createElement("div",{key:t.code,className:"col-2 allocine-movie ".concat(t.code===e.state.movie.idAllocine?"selected":""),onClick:function(){return e.synchronizeTvShowAllocine(t.code)}},t.code===e.state.movie.idAllocine?r.a.createElement("i",{className:"fas fa-check-circle selected-movie-icon fa-2x"}):null,r.a.createElement("div",null,t.title," - ",t.yearStart),r.a.createElement("div",null,t.poster?r.a.createElement("img",{src:t.poster.href,alt:"tvshow poster",style:{width:"100%"}}):null))})))}):null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Genre"),r.a.createElement(oe,{selectedItems:this.state.movie.genre,placeholder:"Genre",items:this.props.application.genres,handleChange:this.onSelect("genre")})),r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Type"),r.a.createElement(de,{selectedItem:this.state.movie.type,placeholder:"Type",items:this.props.application.types,onChange:this.onSelect("type")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"production-year"},"Production Year"),r.a.createElement("input",{type:"number",className:"form-control",id:"production-year","aria-describedby":"production year",placeholder:"Enter production year",onChange:this.onInput("productionYear",function(e){return parseInt(e,10)}),value:this.state.movie.productionYear})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"summary"},"Summary"),r.a.createElement("textarea",{className:"form-control",id:"summary","aria-describedby":"summary",placeholder:"Enter summary",onChange:this.onInput("summary"),value:this.state.movie.summary}))),r.a.createElement("div",{className:"modal-footer"},r.a.createElement("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal"},"Close"),r.a.createElement("button",{type:"button",disabled:!this.valid(),className:"btn btn-primary",onClick:this.state.movie._id?this.update:this.add},t._id?"Update":"Save"))))))}}]),t}(r.a.Component),Ee=(ne=y(ye),function(e){return r.a.createElement(F.Consumer,null,function(t){return r.a.createElement(ne,Object.assign({},e,{application:t}))})}),Oe=function(){var e=Object(a.useContext)(F).status,t=Object(a.useContext)(L),n=t.movies,o=t.count,i=t.addAll,c=t.filters,l=t.add,s=t.update,u=Object(a.useContext)(b),m=Object(a.useState)(n.length/c.limit),d=Object(h.a)(m,2),p=d[0],v=d[1],g=Object(a.useState)({}),y=Object(h.a)(g,2),E=y[0],O=y[1],j=Object(a.useState)(0),k=Object(h.a)(j,2),C=k[0],x=k[1],S=function(e){(function(e,t){return fetch("/api/movies?".concat(e),{headers:N(t)}).then(w)})(function(e,t){var n=e.genres.filter(function(e){return e[1]}).map(function(e){return e[0]}),a=e.genres.filter(function(e){return!e[1]}).map(function(e){return e[0]});return Object.keys(e).filter(function(e){return"genres"!==e}).filter(function(t){return!R()(e[t])&&e[t]||R()(e[t])&&e[t].length>0}).map(function(t){return"".concat(t,"=").concat(e[t])}).concat(n.length>0?"genres=".concat(n.join(",")):"",a.length>0?"notGenres=".concat(a.join(",")):"","offset=".concat(t)).filter(Boolean).join("&")}(c,e),u).then(i).then(function(){return v(e+1)})};return Object(a.useEffect)(function(){var e=me()(S,400,{leading:!1,trailing:!0});return 0===n.length&&e(0),function(){return e.cancel()}},[c]),Object(a.useEffect)(function(){C>0&&$("#movie-creator-updator").modal("show")},[E]),r.a.createElement("div",null,e===P?r.a.createElement("div",null,"Loading ...."):r.a.createElement(a.Fragment,null,r.a.createElement(Ee,{key:E._id||C,movie:E._id?E:null,onAdd:function(e){return l(e)},onUpdate:function(e){return s(e._id,e)}}),r.a.createElement("div",null,"Display ",n.length," of ",o," found movies/tvshows"),r.a.createElement("i",{onClick:function(){O({}),x(C+1)},className:"fas fa-plus-circle fa-3x",style:{top:"22px",left:"22px",position:"absolute",color:"#F1F7EE",cursor:"pointer"},title:"Add a movie or a tv show"}),r.a.createElement(se,null),r.a.createElement("div",{className:"movies"},n.map(function(e){return r.a.createElement(A,{key:e._id,movie:e,onChange:function(e){return s(e._id,e)},onDelete:function(t){return s(e._id,void 0)},onEdit:function(){O(Object(f.a)({},e)),x(C+1)}})})),r.a.createElement("div",{className:"text-center m-3"},r.a.createElement("button",{onClick:function(){return S(p)},className:"btn btn-primary btn-lg"},"Load more"))))},je=n(173),ke=function(e){var t=Object(a.useState)(e.value||""),n=Object(h.a)(t,2),o=n[0],i=n[1],c=Object(a.useState)(!e.value),l=Object(h.a)(c,2),s=l[0],u=l[1],m=e.transform||H.a;return r.a.createElement(a.Fragment,null,s?r.a.createElement(a.Fragment,null,r.a.createElement("input",{placeholder:e.placeholder,type:"text",value:o,onChange:function(e){return i(m(e.target.value))}}),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){e.onChange(o),u(!1)}},"OK"),o?r.a.createElement("button",{className:"btn btn-danger",onClick:function(){u(!1)}},"Cancel"):void 0):r.a.createElement("span",{onClick:function(){return u(!0)}},o))},Ce=n(36),xe=Object(je.a)(function(e){var t=e.match,n=e.history,o=Object(a.useContext)(b),i=Object(a.useContext)(L),c=Object(a.useState)(),l=Object(h.a)(c,2),s=l[0],u=l[1];Object(a.useEffect)(function(){return function(e,t){return fetch("/api/movies/".concat(e),{headers:N(t)}).then(w)}(t.params.id,o).then(u)},[t.params.id]);var m,d=function(e){return function(t){var n=Object(Ce.a)(s,e);(function(e,t,n){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id),{method:"PUT",body:JSON.stringify(t),headers:N(n)}).then(w)})(n,n.seasons[t],o).then(f)}},p=function(e){return function(t){return function(n){var a=Object(Ce.a)(s,e),r=a.seasons[t],i=r.episodes[n];console.log(r,i),function(e,t,n,a){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id,"/episodes/").concat(n._id),{method:"PUT",body:JSON.stringify(n),headers:N(a)}).then(w)}(a,r,i,o).then(f)}}},f=function(e){u(e),i.update(e._id,e)};return r.a.createElement("div",{className:"p-2"},s?r.a.createElement("div",null,r.a.createElement("i",{onClick:function(){return n.goBack()},className:"fas fa-arrow-circle-left fa-3x",style:{top:"22px",left:"22px",position:"absolute",color:"#F1F7EE",cursor:"pointer"},title:"Return to the list of movies"}),r.a.createElement("h1",null,s.title," - ",s.productionYear),r.a.createElement("div",{className:"d-flex"},r.a.createElement("div",{className:"pr-2"},r.a.createElement("img",{src:s.fileUrl,style:{maxHeight:"300px"},alt:"movie poster"})),r.a.createElement("div",{className:"pl-2"},s.summary)),r.a.createElement("div",null,"Film"===s.type?r.a.createElement(S,{seen:s.seen,onClick:(m=function(e){e.seen=!e.seen},function(){I(Object(Ce.a)(s,m),o).then(f)})}):void 0),r.a.createElement("div",{className:"text-center"},"Film"!==s.type?r.a.createElement(a.Fragment,null,r.a.createElement("div",null,s.seasons.map(function(e,t){return r.a.createElement(a.Fragment,{key:e._id},r.a.createElement("div",null,"Season ",t+1,"\xa0-\xa0",r.a.createElement(ke,{placeholder:"YYYY",value:e.productionYear,transform:function(e){return parseInt(e,10)},onChange:function(e){return d(function(n){n.seasons[t].productionYear=e})(t)}}),"\xa0",r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return function(e,t,n){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id,"/episodes"),{method:"POST",body:JSON.stringify(t),headers:N(n)}).then(w)}(s,e,o).then(f)}},r.a.createElement("i",{className:"fas fa-plus"}),"\xa0Add episode")),e.episodes.map(function(e,n){return r.a.createElement("div",{key:e._id},r.a.createElement("div",{className:"d-inline"},r.a.createElement(ke,{value:e.title,placeholder:"Title",onChange:function(e){return p(function(a){a.seasons[t].episodes[n].title=e})(t)(n)}})),"\xa0-\xa0",r.a.createElement("div",{className:"d-inline"},r.a.createElement(ke,{value:e.summary,placeholder:"Summary",onChange:function(e){return p(function(a){a.seasons[t].episodes[n].summary=e})(t)(n)}})))}))})),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return function(e,t){return fetch("/api/movies/".concat(e._id,"/seasons"),{method:"POST",body:JSON.stringify(e),headers:N(t)}).then(w)}(s,o).then(f)}},r.a.createElement("i",{className:"fas fa-plus"}),"\xa0Add season")):void 0)):r.a.createElement("span",null,"Loading ...."))}),Se=Symbol("LOADING"),Ne=Symbol("LOADED"),we=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},Ie=y(function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={status:Se,data:void 0},n.debounceFetch=me()(n.fetch,n.props.debounce||0,{leading:!1,trailing:!0}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){this.debounceFetch.cancel()}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e,t=this;return fetch("".concat(this.props.endpoint),{headers:(e=this.props.user,{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)})}).then(we).then(function(e){t.setState({status:Ne,data:e}),t.props.onSuccess&&t.props.onSuccess(e)})})},{key:"componentDidMount",value:function(){this.debounceFetch()}},{key:"render",value:function(){return r.a.createElement(a.Fragment,null,this.props.children({status:this.state.status,data:this.state.data}))}}]),t}(a.Component)),Ae=function(){return r.a.createElement("div",{className:"text-center",style:{backgroundColor:"var(--movie-secondary)",color:"var(--movie-primary)",padding:"4px"}},r.a.createElement("h1",null,"Cinematheque"),r.a.createElement(Ie,{endpoint:"/api/movies?limit=0"},function(e){var t=e.data;return t?r.a.createElement("h6",null,t.count," movies/tvshows"):void 0}))},Te=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(a.Fragment,null,r.a.createElement(Ae,null),r.a.createElement(d.a,null,r.a.createElement(a.Fragment,null,r.a.createElement(p.a,{exact:!0,path:"/",component:Oe}),r.a.createElement(p.a,{exact:!0,path:"/movie/:id",component:xe}))))}}]),t}(a.Component),Re=y(function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={password:""},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.props.user.status===j?r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Login failed"):void 0,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"text",className:"form-control",id:"password","aria-describedby":"password",placeholder:"Enter password",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},onKeyDown:function(t){"Enter"===t.key&&e.props.user.login(e.state.password)}})),r.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.props.user.login(e.state.password)}},"Submit"))}}]),t}(a.Component));i.a.render(r.a.createElement(C,null,r.a.createElement(b.Consumer,null,function(e){var t=e.token;return t?r.a.createElement(D,{token:t},r.a.createElement(U,null,r.a.createElement(Te,null))):r.a.createElement(Re,null)})),document.getElementById("root"))},74:function(e,t,n){e.exports=n(169)},79:function(e,t,n){},81:function(e,t,n){},83:function(e,t,n){}},[[74,2,1]]]);
//# sourceMappingURL=main.c8e8cc35.chunk.js.map
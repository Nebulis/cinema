(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{173:function(e,t,n){},182:function(e,t,n){},184:function(e,t,n){},187:function(e,t,n){},194:function(e,t,n){},196:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(77),i=n.n(c),s=(n(88),n(4)),l=n(5),u=n(7),m=n(6),d=n(8),p=n(199),f=n(198),h=(n(90),n(2)),v=n(3),g=n(14),b=(n(92),n(197)),E=function(e){var t=e.seen,n=e.onClick,a=e.partial,r=void 0!==a&&a;return o.a.createElement("i",{className:"fas fa-eye",style:{color:r&&!t?"var(--warning)":t?"var(--success)":"",cursor:"pointer"},onClick:n})},y=function(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}},O=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},j=function(e){return function(t,n){return e&&a&&a.abort(),a=new AbortController,fetch("/api/movies?".concat(t),{headers:y(n),signal:a.signal}).then(function(e){return a=null,e}).then(O)}},C=function(e,t){return fetch("/api/movies/".concat(e._id),{method:"PUT",body:JSON.stringify(e),headers:y(t)}).then(O)},k=function(e,t,n){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id),{method:"PUT",body:JSON.stringify(t),headers:y(n)}).then(O)},N=n(28),x=n.n(N),w=n(29),S=n.n(w),I=n(19),A=o.a.createContext(),F=function(e){return function(t){return o.a.createElement(A.Consumer,null,function(n){return o.a.createElement(e,Object.assign({},t,{user:n}))})}},P=Symbol(),D=Symbol(),_=Symbol(),T=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},R=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={token:null,status:P,login:n.login.bind(Object(I.a)(Object(I.a)(n)))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("token");t&&fetch("/account",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then(T).then(function(n){var a=n.exp;new Date<new Date(1e3*a)&&e.setState({token:t,status:D})})}},{key:"login",value:function(e){var t=this;fetch("/login",{method:"POST",body:JSON.stringify({password:e}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(T).then(function(e){var n=e.token;t.setState({token:n,status:D}),localStorage.setItem("token",n)}).catch(function(){return t.setState({status:_})})}},{key:"render",value:function(){return o.a.createElement(A.Provider,{value:this.state},this.props.children)}}]),t}(o.a.Component),B=function(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}},Y=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},L=o.a.createContext(),W=Symbol(),M=Symbol(),U=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).set=function(e){return function(t){n.setState(function(n){return Object(h.a)({},n,Object(g.a)({},e,t(n[e])))})}},n.state={genres:[],types:[],tags:[],status:W,set:n.set},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e,t=this,n={headers:{Authorization:"Bearer ".concat(this.props.token)}},a=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")};Promise.all([fetch("/api/movies/genre",n).then(a),fetch("/api/movies/type",n).then(a),(e=this.props,fetch("/api/tags",{headers:B(e)}).then(Y))]).then(function(e){var n=Object(v.a)(e,3),a=n[0],r=n[1],o=n[2];t.setState({genres:a,types:r,tags:o,status:M})})}},{key:"render",value:function(){return o.a.createElement(L.Provider,{value:this.state},this.props.children)}}]),t}(o.a.Component),z=(n(173),function(e){var t,n=e.color,a=e.label,r=e.big,c=e.className,i=void 0===c?"":c,s=e.style,l=void 0===s?{}:s;return o.a.createElement("span",{className:"tag ".concat(r?"big":""," ").concat(i),style:Object(h.a)({backgroundColor:n,color:"".concat((t=n,0===t.indexOf("#")&&(t=t.slice(1)),.299*parseInt(t.slice(0,2),16)+.587*parseInt(t.slice(2,4),16)+.114*parseInt(t.slice(4,6),16)>186?"#000000":"#FFFFFF"))},l)},a)}),J=function(e){var t=e.movie,n=e.onEdit,a=e.onChange,c=e.onDelete,i=Object(r.useContext)(A),s=Object(r.useContext)(L).tags,l=function(e,n){return function(){return C(Object(h.a)({},t,Object(g.a)({},e,n)),i).then(a)}},u="".concat(t.title),m="".concat(t.productionYear," - ").concat(t.genre.join(","));return o.a.createElement("div",{className:"card movie-card"},o.a.createElement("div",{className:"card-body"},o.a.createElement("h5",{className:"card-title"},o.a.createElement(b.a,{to:"movie/".concat(t._id)},o.a.createElement("div",{className:"ellipsis",title:u},u))),o.a.createElement("h6",{className:"card-subtitle mb-2 text-muted ellipsis",title:m},m),o.a.createElement("div",{className:"movie-card-actions",style:{position:"absolute",top:2,right:4}},"Film"!==t.type&&o.a.createElement("i",{className:"fas fa-ban",style:{cursor:"pointer",color:t.finished?"var(--danger)":"black"},onClick:l("finished",!t.finished)}),"Film"===t.type?o.a.createElement(E,{seen:t.seen,onClick:l("seen",!t.seen)}):o.a.createElement(E,{seen:x()(t.seasons.map(function(e){return x()(e.episodes,"seen")&&e.episodes.length>0}))&&t.seasons.length>0,partial:S()(t.seasons.map(function(e){return S()(e.episodes,"seen")&&e.episodes.length>0}))&&t.seasons.length>0}),o.a.createElement("i",{className:"fas fa-pencil-alt",onClick:n,style:{cursor:"pointer"}}),o.a.createElement("i",{className:"fas fa-trash",onClick:function(){window.confirm()&&function(e,t){return fetch("/api/movies/".concat(e._id),{method:"DELETE",headers:y(t)}).then(O)}(t,i).then(c)},style:{cursor:"pointer"}})),o.a.createElement("div",{className:"poster text-center"},o.a.createElement("img",{src:t.fileUrl?t.fileUrl.replace("http:","https:"):"/no-image.png",alt:"movie poster"})),o.a.createElement("div",{className:"mt-2 text-center"},t.tags.map(function(e){return o.a.createElement(z,Object.assign({},s.find(function(t){return t._id===e}),{className:"mr-2"}))}))))},H=n(10),G=n.n(H),V=n(11),X=n(78),q=n.n(X),K=o.a.createContext(),Q=function(){return{productionYear:"",title:"",genres:[],types:[],tags:[],seen:null,finished:null,limit:30}},Z=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).add=function(e){n.setState(function(t){var n=t.movies;return{movies:[e].concat(Object(V.a)(n))}})},n.update=function(e,t){var a=q()(n.state.movies,["_id",e]),r=Object(V.a)(n.state.movies);r[a]=t,n.setState({movies:r.filter(Boolean)})},n.addAll=function(e){var t=e.data,a=e.count;n.setState(function(e){var n=e.movies;return{movies:Object(V.a)(n).concat(Object(V.a)(t)),count:a}})},n.invalidate=function(){n.setState({movies:[],count:0})},n.resetFilters=function(){n.setState({filters:Q()})},n.onChange=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n.setState(function(n){var a=n.filters;return{movies:[],count:0,filters:Object(h.a)({},a,Object(g.a)({},e,t))}})}},n.state={movies:[],count:0,filters:Q(),onChange:n.onChange,addAll:n.addAll,update:n.update,add:n.add,invalidate:n.invalidate,resetFilters:n.resetFilters},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(K.Provider,{value:this.state},this.props.children)}}]),t}(o.a.Component),ee=n(13),te=n.n(ee),ne=n(23),ae=n(18),re=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={selectedItems:n.props.selectedItems||[]},n.stateReducer=function(e,t){switch(t.type){case ae.a.stateChangeTypes.keyDownEnter:case ae.a.stateChangeTypes.clickItem:return Object(h.a)({},t,{highlightedIndex:e.highlightedIndex,isOpen:!0});default:return t}},n.callOnChange=function(e){return function(){n.props.onChange&&n.props.onChange(n.state.selectedItems,n.getStateAndHelpers(e))}},n.handleSelection=function(e,t){n.state.selectedItems.includes(e)?n.removeItem(e,n.callOnChange(t)):n.addSelectedItem(e,n.callOnChange(t))},n.removeItem=function(e,t){n.setState(function(t){return{selectedItems:t.selectedItems.filter(function(t){return t!==e})}},t)},n.getRemoveButtonProps=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick,r=t.item,o=Object(ne.a)(t,["onClick","item"]);return Object(h.a)({onClick:function(t){a&&a(t),t.stopPropagation(),n.removeItem(r,n.callOnChange(e))}},o)}},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){e.selectedItems!==this.props.selectedItems&&this.props.selectedItems!==this.state.selectedItems&&this.setState({selectedItems:this.props.selectedItems||[]})}},{key:"addSelectedItem",value:function(e,t){this.setState(function(t){var n=t.selectedItems;return{selectedItems:Object(V.a)(n).concat([e])}},t)}},{key:"getStateAndHelpers",value:function(e){var t=this.state.selectedItems,n=this.getRemoveButtonProps,a=this.removeItem;return Object(h.a)({getRemoveButtonProps:n(e),removeItem:a,selectedItems:t},e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.render,a=t.children,r=void 0===a?n:a,c=Object(ne.a)(t,["render","children"]);return o.a.createElement(ae.a,Object.assign({},c,{stateReducer:this.stateReducer,onChange:this.handleSelection,selectedItem:null}),function(t){return r(e.getStateAndHelpers(t))})}}]),t}(o.a.Component),oe=n(22),ce=n(43),ie=function(){return{className:oe.css.apply(void 0,arguments)}},se=Object(ce.a)("li")({position:"relative",cursor:"pointer",display:"block",border:"none",height:"auto",textAlign:"left",borderTop:"none",lineHeight:"1em",color:"rgba(0,0,0,.87)",fontSize:"1rem",textTransform:"none",fontWeight:"400",boxShadow:"none",padding:".8rem 1.1rem",whiteSpace:"normal",wordWrap:"normal"},function(e){var t=e.isActive,n=e.isSelected,a=[];return t&&a.push({color:"rgba(0,0,0,.95)",background:"rgba(0,0,0,.03)"}),n&&a.push({color:"rgba(0,0,0,.95)",fontWeight:"700"}),a}),le=Object(ce.a)("ul")({padding:0,marginTop:0,position:"absolute",backgroundColor:"white",width:"100%",maxHeight:"20rem",overflowY:"auto",overflowX:"hidden",outline:"0",transition:"opacity .1s ease",borderRadius:"0 0 .28571429rem .28571429rem",boxShadow:"0 2px 3px 0 rgba(34,36,38,.15)",borderColor:"#96c8da",borderTopWidth:"0",borderRightWidth:1,borderBottomWidth:1,borderLeftWidth:1,borderStyle:"solid",zIndex:10},function(e){return{border:e.isOpen?null:"none"}}),ue=o.a.forwardRef(function(e,t){return o.a.createElement(le,Object.assign({innerRef:t},e))}),me=Object(ce.a)("button")({backgroundColor:"transparent",border:"none",position:"absolute",right:0,top:0,cursor:"pointer",width:47,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",alignItems:"center"});function de(e){var t=e.isOpen;return o.a.createElement("svg",{viewBox:"0 0 20 20",preserveAspectRatio:"none",width:16,fill:"transparent",stroke:"#979797",strokeWidth:"1.1px",transform:t?"rotate(180)":null},o.a.createElement("path",{d:"M1,6 L10,15 L19,6"}))}var pe,fe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={selectedItems:n.props.selectedItems||[]},n.stateReducer=function(e,t){switch(t.type){case ae.a.stateChangeTypes.keyDownEnter:case ae.a.stateChangeTypes.clickItem:return Object(h.a)({},t,{highlightedIndex:e.highlightedIndex,isOpen:!0});default:return t}},n.callOnChange=function(e){return function(){n.props.onChange&&n.props.onChange(n.state.selectedItems,n.getStateAndHelpers(e))}},n.handleSelection=function(e,t){n.state.selectedItems.filter(function(t){return e===t[0]}).length>0?n.removeItem([e],n.callOnChange(t)):n.addSelectedItem(e,n.callOnChange(t))},n.removeItem=function(e,t){n.setState(function(t){return{selectedItems:t.selectedItems.filter(function(t){return t[0]!==e[0]})}},t)},n.getRemoveButtonProps=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick,r=t.item,o=Object(ne.a)(t,["onClick","item"]);return Object(h.a)({onClick:function(t){a&&a(t),t.stopPropagation(),n.removeItem(r,n.callOnChange(e))}},o)}},n.clickOnItem=function(e){return function(t,a){n.setState(function(e){var n=e.selectedItems;return n[a]=[t[0],!t[1]],{selectedItems:n.filter(function(e){return e!==t[0]})}},n.callOnChange(e))}},n.displayItem=function(e){return e[0]},n.displayBackground=function(e){return e[1]?"#ccc":"tomato"},n.isSelected=function(e){return n.state.selectedItems.find(function(t){return t[0]===e})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"addSelectedItem",value:function(e,t){this.setState(function(t){var n=t.selectedItems;return{selectedItems:Object(V.a)(n).concat([[e,!0]])}},t)}},{key:"getStateAndHelpers",value:function(e){var t=this.state.selectedItems,n=this.getRemoveButtonProps,a=this.removeItem,r=this.clickOnItem,o=this.displayItem,c=this.displayBackground,i=this.isSelected;return Object(h.a)({getRemoveButtonProps:n(e),removeItem:a,selectedItems:t,clickOnItem:r(e),displayItem:o,displayBackground:c,isSelected:i},e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.render,a=t.children,r=void 0===a?n:a,c=Object(ne.a)(t,["render","children"]);return o.a.createElement(ae.a,Object.assign({},c,{stateReducer:this.stateReducer,onChange:this.handleSelection,selectedItem:null}),function(t){return r(e.getStateAndHelpers(t))})}}]),t}(o.a.Component),he=function(e){return function(t){function n(){return Object(s.a)(this,n),Object(u.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(d.a)(n,t),Object(l.a)(n,[{key:"render",value:function(){var t=this.props,n=t.handleChange,a=t.placeholder,r=t.items,c=t.selectedItems;return o.a.createElement(e,{onChange:n,selectedItems:c,placeholder:a},function(e){var t=e.getToggleButtonProps,n=e.getMenuProps,c=e.getRemoveButtonProps,i=(e.removeItem,e.isOpen),s=e.selectedItems,l=e.getItemProps,u=e.highlightedIndex,m=e.toggleMenu,d=e.clickOnItem,p=void 0===d?function(){}:d,f=e.displayItem,h=void 0===f?te.a:f,v=e.displayBackground,g=void 0===v?function(){return"#ccc"}:v,b=e.isSelected,E=void 0===b?function(e){return s.includes(e)}:b;return o.a.createElement("div",{style:{margin:"auto",position:"relative",width:"100%"}},o.a.createElement("div",Object.assign({},ie({cursor:"pointer",position:"relative",padding:".375rem .75rem",paddingRight:50,border:"1px solid #ced4da",borderRadius:".25rem",backgroundColor:"white"}),{onClick:function(){m()}}),o.a.createElement("div",ie({display:"flex",flexWrap:"wrap",alignItems:"center"}),s.length>0?s.map(function(e,t){return o.a.createElement("div",Object.assign({key:t},ie({margin:"0 2px",paddingLeft:8,paddingRight:8,display:"inline-block",wordWrap:"none",backgroundColor:g(e),borderRadius:2}),{onClick:function(n){n.preventDefault(),n.stopPropagation(),p(e,t)}}),o.a.createElement("div",ie({display:"grid",gridGap:6,gridAutoFlow:"column",alignItems:"center"}),o.a.createElement("span",null,h(e)),o.a.createElement("button",Object.assign({},c({item:e}),ie({cursor:"pointer",lineHeight:.8,border:"none",backgroundColor:"transparent",padding:"0",fontSize:"16px"}),{type:"button"}),"\ud835\ude05")))}):o.a.createElement("span",ie({color:"#6c757d;"}),a)),o.a.createElement(me,t({onClick:function(e){e.stopPropagation()}}),o.a.createElement(de,{isOpen:i}))),o.a.createElement(ue,n({isOpen:i}),i?r.map(function(e,t){return o.a.createElement(se,Object.assign({key:t},l({item:e,index:t,isActive:u===t,isSelected:E(e)})),e)}):null))})}}]),n}(r.Component)},ve=he(re),ge=he(fe),be=function(e){return e.target.value},Ee=function(e,t){var n=e.filters,a=e.onChange,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te.a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:be;return{value:n[t],onChange:function(e){return a(t)(r(o(e)))}}},ye=function(e){var t=e.tag,n=e.selected,a=e.onAdd,r=e.onDelete;return o.a.createElement("span",{onClick:n?r:a},o.a.createElement(z,Object.assign({},t,{className:"filter-tag mr-2 ".concat(n?"selected":"")})))},Oe=function(){var e=Object(r.useContext)(K),t=e.filters,n=e.onChange,a=Object(r.useContext)(L),c=a.genres,i=a.types,s=a.tags,l=t.seen,u=t.finished;return o.a.createElement("form",{className:"form-inline movies-filter mt-4 ml-3"},o.a.createElement("div",{className:"form-group mr-2"},o.a.createElement("input",Object.assign({},Ee({filters:t,onChange:n},"productionYear",function(e){return parseInt(e,10)}),{type:"number",max:2200,placeholder:"YYYY",className:"form-control",style:{width:"90px"}}))),o.a.createElement("div",{className:"form-group mr-2"},o.a.createElement("input",Object.assign({type:"text"},Ee({filters:t,onChange:n},"title"),{placeholder:"Title",className:"form-control"}))),o.a.createElement("div",{className:"form-group mr-2",style:{minWidth:"220px"}},o.a.createElement(ge,{placeholder:"Genre",handleChange:Ee({filters:t,onChange:n},"genres",te.a,te.a).onChange,items:c,selectedItems:t.genres})),o.a.createElement("div",{className:"form-group mr-2",style:{width:"220px"}},o.a.createElement(ve,{placeholder:"Type",handleChange:Ee({filters:t,onChange:n},"types",te.a,te.a).onChange,items:i,selectedItems:t.types})),o.a.createElement("div",{className:"form-group mr-2"},function(){var e="",t="fa-eye",a=function(){return n("seen")("true")};return"true"===l?(e="var(--success)",a=function(){return n("seen")("partial")}):"partial"===l?(e="var(--warning)",a=function(){return n("seen")("false")}):"false"===l&&(e="var(--danger)",t="fa-eye-slash",a=function(){return n("seen")(null)}),o.a.createElement("i",{className:"fas ".concat(t),style:{color:e,cursor:"pointer"},onClick:a})}()),o.a.createElement("div",{className:"form-group mr-2"},function(){var e="",t=function(){return n("finished")(!0)};return!0===u&&(e="var(--danger)",t=function(){return n("finished")(null)}),o.a.createElement("i",{className:"fas fa-ban",style:{color:e,cursor:"pointer"},onClick:t})}()),o.a.createElement("div",null,s.map(function(e){return o.a.createElement(ye,{key:e._id,tag:e,selected:t.tags.find(function(t){return t===e._id}),onAdd:function(){return n("tags")(Object(V.a)(t.tags).concat([e._id]))},onDelete:function(){return n("tags")(t.tags.filter(function(t){return t!==e._id}))}})})))},je=n(40),Ce=n.n(je),ke=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.placeholder,a=e.items,r=e.selectedItem;return o.a.createElement(ae.a,{onChange:t,selectedItem:r},function(e){e.getInputProps;var t=e.getItemProps,r=(e.getLabelProps,e.getMenuProps),c=e.isOpen,i=(e.inputValue,e.highlightedIndex),s=e.selectedItem,l=e.toggleMenu;return o.a.createElement("div",{style:{margin:"auto",position:"relative",width:"100%"}},o.a.createElement("div",Object.assign({},ie({cursor:"pointer",position:"relative",padding:".375rem .75rem",paddingRight:50,border:"1px solid #ced4da",borderRadius:".25rem",backgroundColor:"white"}),{onClick:function(){l()}}),o.a.createElement("div",ie({display:"flex",flexWrap:"wrap",alignItems:"center"}),s?o.a.createElement("div",ie({margin:"0 2px",paddingLeft:8,paddingRight:8,display:"inline-block",wordWrap:"none",backgroundColor:"#ccc",borderRadius:2}),o.a.createElement("div",ie({display:"grid",gridGap:6,gridAutoFlow:"column",alignItems:"center"}),o.a.createElement("span",null,s))):o.a.createElement("span",ie({color:"#6c757d;"}),n)),o.a.createElement(me,null,o.a.createElement(de,{isOpen:c}))),o.a.createElement(ue,r({isOpen:c}),c?a.map(function(e,n){return o.a.createElement(se,Object.assign({key:n},t({item:e,index:n,isActive:i===n,isSelected:s===e})),e)}):null))})}}]),t}(o.a.Component),Ne=n(55),xe=n.n(Ne),we=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={open:!1,toggle:n.toggle.bind(Object(I.a)(Object(I.a)(n)))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({open:!this.state.open})}},{key:"render",value:function(){return o.a.createElement(r.Fragment,null,this.props.children(this.state))}}]),t}(r.Component),Se={movie:{title:"",genre:[],type:"",productionYear:"",summary:""},allocine:{movies:[],tvshows:[]}},Ie=function(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}},Ae=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},Fe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).valid=function(){return!xe()(n.state.movie.title)&&n.state.movie.genre.length>0&&!xe()(n.state.movie.type)},n.add=function(){fetch("/api/movies",{method:"POST",body:JSON.stringify(n.state.movie),headers:Ie(n.props.user)}).then(Ae).then(function(e){n.props.onAdd(Object(h.a)({},n.state.movie,e)),$("#movie-creator-updator").modal("hide")})},n.update=function(){fetch("/api/movies/".concat(n.props.movie._id),{method:"PUT",body:JSON.stringify(n.state.movie),headers:Ie(n.props.user)}).then(Ae).then(function(e){n.props.onUpdate(Object(h.a)({},n.state.movie,e)),$("#movie-creator-updator").modal("hide")})},n.search=function(){Promise.all([fetch("/api/allocine?type=Film&title=".concat(n.state.movie.title),{headers:Ie(n.props.user)}).then(Ae),fetch("/api/allocine?type=S\xe9rie&title=".concat(n.state.movie.title),{headers:Ie(n.props.user)}).then(Ae)]).then(function(e){var t=Object(v.a)(e,2),a=t[0],r=t[1];return n.setState({allocine:{movies:a,tvshows:r}})})},n.synchronizeMovieAllocine=function(e){e===n.state.movie.idAllocine?n.setState({movie:Object(h.a)({},n.state.movie,{idAllocine:null})}):fetch("/api/allocine/movie/".concat(e),{headers:Ie(n.props.user)}).then(Ae).then(function(t){var a=t.movie;return n.setState({movie:Object(h.a)({},n.state.movie,{idAllocine:e,title:a.title,genre:a.genre.map(function(e){return e.$}).sort(),type:"Film",productionYear:a.release&&a.release.releaseDate?new Date(a.release.releaseDate).getFullYear():a.productionYear,summary:a.synopsis,fileUrl:a.poster?a.poster.href:""})})})},n.synchronizeTvShowAllocine=function(e){e===n.state.movie.idAllocine?n.setState({movie:Object(h.a)({},n.state.movie,{idAllocine:null})}):fetch("/api/allocine/serie/".concat(e),{headers:Ie(n.props.user)}).then(Ae).then(function(t){var a=t.tvseries;return n.setState({movie:Object(h.a)({},n.state.movie,{idAllocine:e,title:a.title,genre:a.genre.map(function(e){return e.$}).sort(),type:"S\xe9rie",productionYear:a.yearStart,summary:a.synopsis,fileUrl:a.poster?a.poster.href:""})})})},n.onInput=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return function(a){return n.setState({movie:Object(h.a)({},n.state.movie,Object(g.a)({},e,t(a.target.value)))})}},n.onSelect=function(e){return function(t){return n.setState({movie:Object(h.a)({},n.state.movie,Object(g.a)({},e,t))})}},n.state={movie:e.movie?e.movie:Se.movie,allocine:Se.allocine},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){$("#movie-creator-updator").on("hide.bs.modal",this.props.onClose)}},{key:"render",value:function(){var e=this,t=this.state.movie;return o.a.createElement(r.Fragment,null,this.props.application.status===W?o.a.createElement("div",null,"Loading..."):o.a.createElement("div",{className:"movie-modal modal fade movie-form",id:"movie-creator-updator",tabIndex:"-1",role:"dialog","data-show":"true"},o.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},t&&t.title||"New"),o.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"form-row"},o.a.createElement("div",{className:"form-group col-11"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",className:"form-control",id:"title","aria-describedby":"title",placeholder:"Enter title",onChange:this.onInput("title"),value:this.state.movie.title})),o.a.createElement("div",{className:"form-group col-1 text-center"},o.a.createElement("i",{className:"fab fa-angular fa-2x",style:{cursor:"pointer",color:"#fecc00",paddingTop:"35px"},onClick:this.search}))),this.state.allocine.movies.length>0?o.a.createElement(we,null,function(t){var n=t.open,a=t.toggle;return o.a.createElement(r.Fragment,null,o.a.createElement("div",{onClick:a,style:{cursor:"pointer"}},e.state.allocine.movies.length," movies",n?o.a.createElement("i",{className:"fas fa-chevron-up"}):o.a.createElement("i",{className:"fas fa-chevron-down"})),o.a.createElement("div",{className:"row",style:{overflowX:"scroll",display:n?"flex":"none",flexWrap:"nowrap"}},e.state.allocine.movies.map(function(t){return o.a.createElement("div",{key:t.code,className:"col-2 allocine-movie ".concat(t.code===e.state.movie.idAllocine?"selected":""),onClick:function(){return e.synchronizeMovieAllocine(t.code)}},t.code===e.state.movie.idAllocine?o.a.createElement("i",{className:"fas fa-check-circle selected-movie-icon fa-2x"}):null,o.a.createElement("div",null,t.title," -"," ",t.release&&t.release.releaseDate?new Date(t.release.releaseDate).getFullYear():t.productionYear),o.a.createElement("div",null,t.poster?o.a.createElement("img",{src:t.poster.href,alt:"movie poster",style:{width:"100%"}}):null))})))}):null,this.state.allocine.tvshows.length>0?o.a.createElement(we,null,function(t){var n=t.open,a=t.toggle;return o.a.createElement(r.Fragment,null,o.a.createElement("div",{onClick:a,style:{cursor:"pointer"}},e.state.allocine.tvshows.length," tv shows",n?o.a.createElement("i",{className:"fas fa-chevron-up"}):o.a.createElement("i",{className:"fas fa-chevron-down"})),o.a.createElement("div",{className:"row",style:{overflowX:"scroll",display:n?"flex":"none",flexWrap:"nowrap"}},e.state.allocine.tvshows.map(function(t){return o.a.createElement("div",{key:t.code,className:"col-2 allocine-movie ".concat(t.code===e.state.movie.idAllocine?"selected":""),onClick:function(){return e.synchronizeTvShowAllocine(t.code)}},t.code===e.state.movie.idAllocine?o.a.createElement("i",{className:"fas fa-check-circle selected-movie-icon fa-2x"}):null,o.a.createElement("div",null,t.title," - ",t.yearStart),o.a.createElement("div",null,t.poster?o.a.createElement("img",{src:t.poster.href,alt:"tvshow poster",style:{width:"100%"}}):null))})))}):null,o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"Genre"),o.a.createElement(ve,{selectedItems:this.state.movie.genre,placeholder:"Genre",items:this.props.application.genres,handleChange:this.onSelect("genre")})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",null,"Type"),o.a.createElement(ke,{selectedItem:this.state.movie.type,placeholder:"Type",items:this.props.application.types,onChange:this.onSelect("type")})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",{htmlFor:"production-year"},"Production Year"),o.a.createElement("input",{type:"number",className:"form-control",id:"production-year","aria-describedby":"production year",placeholder:"Enter production year",onChange:this.onInput("productionYear",function(e){return parseInt(e,10)}),value:this.state.movie.productionYear})),o.a.createElement("div",{className:"form-group"},o.a.createElement("label",{htmlFor:"summary"},"Summary"),o.a.createElement("textarea",{className:"form-control",id:"summary","aria-describedby":"summary",placeholder:"Enter summary",onChange:this.onInput("summary"),value:this.state.movie.summary}))),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal"},"Close"),o.a.createElement("button",{type:"button",disabled:!this.valid(),className:"btn btn-primary",onClick:this.state.movie._id?this.update:this.add},t._id?"Update":"Save"))))))}}]),t}(o.a.Component),Pe=(pe=F(Fe),function(e){return o.a.createElement(L.Consumer,null,function(t){return o.a.createElement(pe,Object.assign({},e,{application:t}))})}),De=j(!0),_e=function(){var e=Object(r.useContext)(L).status,t=Object(r.useContext)(K),n=t.invalidate,a=t.movies,c=t.count,i=t.addAll,s=t.filters,l=t.add,u=t.update,m=Object(r.useContext)(A),d=Object(r.useState)(a.length/s.limit),p=Object(v.a)(d,2),f=p[0],g=p[1],b=Object(r.useState)({}),E=Object(v.a)(b,2),y=E[0],O=E[1],j=Object(r.useState)(0),C=Object(v.a)(j,2),k=C[0],N=C[1],x=Object(r.useState)(!0),w=Object(v.a)(x,2),S=w[0],I=w[1],F=function(e){0===e&&n(),I(!1),De(function(e,t){var n=e.genres.filter(function(e){return e[1]}).map(function(e){return e[0]}),a=e.genres.filter(function(e){return!e[1]}).map(function(e){return e[0]});return Object.keys(e).filter(function(e){return"genres"!==e}).filter(function(t){return!G()(e[t])&&null!==e[t]&&""!==e[t]||G()(e[t])&&e[t].length>0}).map(function(t){return"".concat(t,"=").concat(e[t])}).concat(n.length>0?"genres=".concat(n.join(",")):"",a.length>0?"notGenres=".concat(a.join(",")):"","offset=".concat(t)).filter(Boolean).join("&")}(s,e),m).then(i).then(function(){g(e+1),I(!0)})};return Object(r.useEffect)(function(){var e=Ce()(F,400,{leading:!1,trailing:!0});return 0===a.length&&(e(0),I(!1)),function(){return e.cancel()}},[s]),Object(r.useEffect)(function(){k>0&&$("#movie-creator-updator").modal("show")},[y]),o.a.createElement("div",null,e===W?o.a.createElement("h2",{className:"text-center mt-2"},o.a.createElement("i",{className:"fas fa-spinner fa-spin fa-2x"})):o.a.createElement(r.Fragment,null,o.a.createElement(Pe,{key:y._id||k,movie:y._id?y:null,onAdd:function(e){return l(e)},onUpdate:function(e){return u(e._id,e)}}),o.a.createElement("i",{onClick:function(){O({}),N(k+1)},className:"fas fa-plus-circle fa-3x",style:{top:"22px",left:"22px",position:"absolute",color:"#F1F7EE",cursor:"pointer"},title:"Add a movie or a tv show"}),o.a.createElement(Oe,null),o.a.createElement("h2",{className:"text-center"},a.length===c&&c>0?o.a.createElement("span",null,c," movies/tvshows"):a.length<c?o.a.createElement("span",null,a.length," of ",c," movies/tvshows"):S?o.a.createElement("span",null," No movies/tvshows"):null),o.a.createElement("div",{className:"movies"},a.map(function(e){return o.a.createElement(J,{key:e._id,movie:e,onChange:function(e){return u(e._id,e)},onDelete:function(t){return u(e._id,void 0)},onEdit:function(){O(Object(h.a)({},e)),N(k+1)}})})),o.a.createElement("h2",{className:"text-center mt-2"},S?null:o.a.createElement("span",null,o.a.createElement("i",{className:"fas fa-spinner fa-spin fa-2x"}))),a.length<c?o.a.createElement("div",{className:"text-center m-3"},o.a.createElement("button",{onClick:function(){return F(f)},className:"btn btn-primary btn-lg"},"Load more")):void 0))},Te=n(200),Re=n(12),Be=function(e){var t=Object(r.useState)(e.value||""),n=Object(v.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!e.value),s=Object(v.a)(i,2),l=s[0],u=s[1],m=e.transform||te.a,d=e.lock||!1;return o.a.createElement(r.Fragment,null,!d&&l?o.a.createElement(r.Fragment,null,e.renderFormField(Object(h.a)({},e,{value:a,onChange:function(e){return c(m(e.target.value))}})),o.a.createElement("button",{className:"btn btn-primary",onClick:function(t){t.preventDefault(),t.stopPropagation(),a&&(e.onChange(a),u(!1))}},"OK")):o.a.createElement(r.Fragment,null,e.renderValue({className:e.className,value:a,onClick:function(e){d||(e.preventDefault(),e.stopPropagation(),u(!0))}})))},Ye=function(e){return o.a.createElement(Be,Object.assign({},e,{renderFormField:function(e){return o.a.createElement("input",{placeholder:e.placeholder,type:"text",value:e.value,onChange:e.onChange,onClick:function(e){e.preventDefault(),e.stopPropagation()}})},renderValue:function(e){return o.a.createElement("span",{onClick:e.onClick,className:e.className},e.value)}}))},Le=function(e){return o.a.createElement(Be,Object.assign({},e,{renderFormField:function(e){return o.a.createElement("textarea",{placeholder:e.placeholder,style:e.style,value:e.value,rows:e.rows||2,onChange:e.onChange,onClick:function(e){e.preventDefault(),e.stopPropagation()}})},renderValue:function(t){return o.a.createElement("span",{onClick:t.onClick,className:t.className},e.split?t.value.split("\n").map(function(e,t){return o.a.createElement(r.Fragment,{key:t},e,o.a.createElement("br",null))}):o.a.createElement(r.Fragment,null,t.value))}}))},We=(n(182),function(e){var t=e.episode,n=e.index,a=e.onEpisodeChanged,c=Object(r.useContext)(A),i=Object(r.useContext)(He),s=i.movie,l=i.lock,u=Object(r.useContext)(ze),m=u.season,d=u.index,p=Object(r.useState)("ellipsis"),f=Object(v.a)(p,2),h=f[0],g=f[1],b=function(e){var t=Object(Re.a)(s,e),r=t.seasons[d];(function(e,t,n,a){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id,"/episodes/").concat(n._id),{method:"PUT",body:JSON.stringify(n),headers:y(a)}).then(O)})(t,r,r.episodes[n],c).then(a)};return o.a.createElement("div",{className:"row episode mr-0 ml-0"},o.a.createElement("div",{className:" col-md-12 col-xl-2 align-items-center d-flex p-0"},!l&&o.a.createElement("i",{className:"fas fa-times delete-episode",onClick:function(e){e.preventDefault(),e.stopPropagation(),window.confirm("Delete episode ?")&&function(e,t,n,a){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id,"/episodes/").concat(n._id),{method:"DELETE",headers:y(a)}).then(O)}(s,m,t,c).then(a)}}),o.a.createElement("div",{className:"text-center col-1",style:{color:t.seen?"var(--success)":"",fontWeight:t.seen?"bold":"",cursor:"pointer"},onClick:function(){return function(e){var t=Object(Re.a)(s,e),n=t.seasons[d];k(t,n,c).then(a)}(function(e){if(e.seasons[d].episodes[n].seen)e.seasons[d].episodes[n].seen=!1;else for(var t=0;t<=n;t++)e.seasons[d].episodes[t].seen=!0})}},n+1),o.a.createElement("div",{className:"text-center col-11"},o.a.createElement(Ye,{lock:l,className:"font-weight-bold episode-title ".concat(t.seen?"seen":""),value:t.title,placeholder:"Title",onChange:function(e){return b(function(t){t.seasons[d].episodes[n].title=e})}}))),o.a.createElement("div",{className:"col-md-12 col-xl-10 align-items-center d-flex"},o.a.createElement(Le,{lock:l,style:{width:"100%"},rows:4,value:t.summary,placeholder:"Summary",className:"".concat(h," d-block episode-summary w-100 text-left"),onChange:function(e){return b(function(t){t.seasons[d].episodes[n].summary=e})}}),h&&o.a.createElement("span",{style:{cursor:"pointer"},onClick:function(){return g("")}},o.a.createElement("i",{className:"fas fa-question-circle"}))))}),Me=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(r.useState)(e),n=Object(v.a)(t,2),a=n[0],o=n[1];return[a,function(){return o(!a)}]},Ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Object(r.useState)(e),n=Object(v.a)(t,2),a=n[0],o=n[1];return[{value:a,onChange:function(e){return o(e.target.value)}},o]},ze=o.a.createContext({}),Je=function(e){var t=e.season,n=e.index,a=e.onMovieChanged,c=Object(r.useContext)(A),i=Object(r.useContext)(He),s=i.movie,l=i.lock,u=Me(),m=Object(v.a)(u,2),d=m[0],p=m[1],f=function(e){var t=Object(Re.a)(s,e),r=t.seasons[n];k(t,r,c).then(a)},h=x()(t.episodes,"seen")&&t.episodes.length>0,g=S()(t.episodes,"seen")&&t.episodes.length>0;return o.a.createElement("div",{className:"season"},o.a.createElement("div",{className:"season-header",onClick:p},o.a.createElement("div",null,o.a.createElement("div",{className:"season-header-view",onClick:function(e){e.preventDefault(),e.stopPropagation(),f(function(e){e.seasons[n].seen=!h})}},o.a.createElement(E,{seen:h,partial:g})),!l&&o.a.createElement("i",{className:"fas fa-times delete-season",onClick:function(e){e.preventDefault(),e.stopPropagation(),window.confirm("Delete season ?")&&function(e,t,n){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id),{method:"DELETE",headers:y(n)}).then(O)}(s,t,c).then(a)}}),"\xa0Season ",n+1,"\xa0-\xa0",o.a.createElement(Ye,{lock:l,placeholder:"YYYY",value:t.productionYear,transform:function(e){return parseInt(e,10)},onChange:function(e){return f(function(t){t.seasons[n].productionYear=e})}})),o.a.createElement("div",{className:"season-header-arrow"},d?o.a.createElement("i",{className:"fas fa-chevron-up"}):o.a.createElement("i",{className:"fas fa-chevron-down"}))),o.a.createElement("div",{className:"episodes"},o.a.createElement(ze.Provider,{value:{season:t,index:n}},d&&t.episodes.map(function(e,t){return o.a.createElement(We,{key:e._id,episode:e,index:t,onEpisodeChanged:a})}))),l?void 0:o.a.createElement(r.Fragment,null,d&&o.a.createElement("button",{className:"btn btn-primary",onClick:function(){return function(e,t,n){return fetch("/api/movies/".concat(e._id,"/seasons/").concat(t._id,"/episodes"),{method:"POST",body:JSON.stringify(t),headers:y(n)}).then(O)}(s,t,c).then(a)}},o.a.createElement("i",{className:"fas fa-plus"}),"\xa0Add episode")))},He=(n(184),o.a.createContext({})),Ge=function(e){var t=e.tag,n=e.selected,a=e.onAdd,r=e.onDelete;return e.lock?n?o.a.createElement("span",{className:"mt-1"},o.a.createElement(z,Object.assign({},t,{className:"mr-1 selected"}))):null:o.a.createElement("span",{onClick:n?r:a,className:"mt-1"},o.a.createElement(z,Object.assign({},t,{className:"movie-tag mr-1 ".concat(n?"selected":"")})))},$e=Object(Te.a)(function(e){var t=e.match,n=e.history,a=Object(r.useContext)(A),c=Object(r.useContext)(K),i=Object(r.useContext)(L).tags,s=Object(r.useState)(),l=Object(v.a)(s,2),u=l[0],m=l[1],d=Me(!0),p=Object(v.a)(d,2),f=p[0],h=p[1],g=Object(r.useRef)();Object(r.useEffect)(function(){return function(e,t){return fetch("/api/movies/".concat(e),{headers:y(t)}).then(O)}(t.params.id,a).then(m)},[t.params.id]);var b=function(e){return function(){C(Object(Re.a)(u,e),a).then(k)}},j=function(e){1===e.length&&function(e,t,n){var a=new FormData;return a.append("file",t),fetch("/api/movies/".concat(e._id,"/poster"),{method:"POST",body:a,headers:{Accept:"application/json",Authorization:"Bearer ".concat(n.token)}}).then(O)}(u,e[0],a).then(k)},k=function(e){m(e),c.update(e._id,e)};return o.a.createElement("div",{className:"container movie-container"},u?o.a.createElement(r.Fragment,null,o.a.createElement("i",{onClick:function(){return n.goBack()},className:"fas fa-arrow-circle-left fa-3x",style:{top:"22px",left:"22px",position:"absolute",color:"#F1F7EE",cursor:"pointer"},title:"Return to the list of movies"}),o.a.createElement("div",{className:"p-5 mt-3 single-movie-card",style:{position:"relative"}},o.a.createElement("i",{onClick:h,className:"fas ".concat(f?"fa-lock":"fa-lock-open"," fa-2x"),style:{color:"var(--movie-secondary)",position:"absolute",top:"5px",right:"5px",cursor:"pointer"},title:"Click to ".concat(f?"open":"close"," movie for modifications")}),o.a.createElement("div",{className:"d-flex"},o.a.createElement("div",{className:"d-flex",style:{flex:"0 0 250px",flexDirection:"column"}},o.a.createElement("input",{accept:".jpg, .jpeg, .png",type:"file",ref:g,style:{display:"none"},onChange:function(e){return j(e.target.files)}}),o.a.createElement("img",{src:u.fileUrl?u.fileUrl.replace("http:","https:"):"/no-image.png",style:{height:"300px",width:"225px",cursor:f?"auto":"pointer"},alt:"movie poster",onClick:function(){return!f&&g.current.click()}}),o.a.createElement("div",{className:"d-flex flex-wrap"},i.map(function(e){return o.a.createElement(Ge,{key:e._id,tag:e,lock:f,selected:u.tags.find(function(t){return t===e._id}),onAdd:b(function(t){t.tags.push(e._id)}),onDelete:b(function(t){t.tags=t.tags.filter(function(t){return t!==e._id})})})}))),o.a.createElement("div",{className:"pl-4 d-flex flex-column"},o.a.createElement("h1",{className:"text-center"},u.title," - ",u.productionYear),o.a.createElement("h6",{className:"text-center single-movie-subtitle"},u.genre.join(",")),o.a.createElement("div",null,o.a.createElement(Le,{split:!0,lock:f,value:u.summary,style:{width:"100%"},placeholder:"Summary",rows:"7",onChange:function(e){return b(function(t){t.summary=e})()}})))),o.a.createElement("div",null,"Film"===u.type?o.a.createElement(E,{seen:u.seen,onClick:b(function(e){e.seen=!e.seen})}):void 0),o.a.createElement("div",{className:"text-center"},"Film"!==u.type?o.a.createElement(r.Fragment,null,o.a.createElement(He.Provider,{value:{lock:f,movie:u}},o.a.createElement("div",null,u.seasons.map(function(e,t){return o.a.createElement(Je,{key:t,season:e,index:t,onMovieChanged:k})}))),f?void 0:o.a.createElement("button",{className:"btn btn-primary",onClick:function(){return function(e,t){return fetch("/api/movies/".concat(e._id,"/seasons"),{method:"POST",body:JSON.stringify(e),headers:y(t)}).then(O)}(u,a).then(k)}},o.a.createElement("i",{className:"fas fa-plus"}),"\xa0Add season")):void 0))):o.a.createElement("h2",{className:"text-center mt-2"},o.a.createElement("i",{className:"fas fa-spinner fa-spin fa-2x"})))}),Ve=Symbol("LOADING"),Xe=Symbol("LOADED"),qe=function(e){if(e.ok)return e.json();throw new Error("Fetch fail")},Ke=F(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={status:Ve,data:void 0},n.debounceFetch=Ce()(n.fetch,n.props.debounce||0,{leading:!1,trailing:!0}),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){this.debounceFetch.cancel()}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e,t=this;return fetch("".concat(this.props.endpoint),{headers:(e=this.props.user,{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)})}).then(qe).then(function(e){t.setState({status:Xe,data:e}),t.props.onSuccess&&t.props.onSuccess(e)})})},{key:"componentDidMount",value:function(){this.debounceFetch()}},{key:"render",value:function(){return o.a.createElement(r.Fragment,null,this.props.children({status:this.state.status,data:this.state.data}))}}]),t}(r.Component)),Qe=function(){return o.a.createElement("div",{className:"text-center",style:{backgroundColor:"var(--movie-secondary)",color:"var(--movie-primary)",padding:"4px"}},o.a.createElement("h1",{className:"header"},o.a.createElement(b.a,{to:"/"},"Cinematheque")),o.a.createElement(Ke,{endpoint:"/api/movies?limit=0"},function(e){var t=e.data;return o.a.createElement("h6",null,t?t.count:0," movies/tvshows")}),o.a.createElement(b.a,{to:"/stats"},o.a.createElement("i",{className:"fas fa-chart-bar fa-3x",style:{top:"22px",right:"22px",position:"absolute",color:"#F1F7EE",cursor:"pointer"},title:"Show statistics"})))},Ze=(n(187),n(30)),et=n.n(Ze),tt=j(!1),nt=function(e,t,n){return{types:e.map(function(e){return{name:e,count:0,genres:t.map(function(e){return{name:e,count:0,seen:0,unseen:0}})}}),tags:n.map(function(e){return{name:e.label,color:e.color,count:0}})}},at=Object(Te.a)(function(e){var t=e.history,n=Object(r.useContext)(A),a=Object(r.useContext)(L),c=a.genres,i=a.types,s=a.tags,l=Object(r.useContext)(K),u=l.resetFilters,m=l.onChange,d=Object(r.useState)(nt(i,c,s)),p=Object(v.a)(d,2),f=p[0],h=p[1];return Object(r.useEffect)(function(){h(nt(i,c,s)),function(e,t){e.forEach(function(e){return tt("types=".concat(e,"&limit=0"),n).then(function(t){return h(Object(Re.a)(function(n){n.types.find(function(t){return e===t.name}).count=t.count}))}).then(function(){return t.forEach(function(t){tt("types=".concat(e,"&genres=").concat(t,"&limit=0"),n).then(function(n){return h(Object(Re.a)(function(a){a.types.find(function(t){return e===t.name}).genres.find(function(e){return t===e.name}).count=n.count}))}),tt("types=".concat(e,"&genres=").concat(t,"&seen=true&limit=0"),n).then(function(n){return h(Object(Re.a)(function(a){a.types.find(function(t){return e===t.name}).genres.find(function(e){return t===e.name}).seen=n.count}))}),tt("types=".concat(e,"&genres=").concat(t,"&seen=false&limit=0"),n).then(function(n){return h(Object(Re.a)(function(a){a.types.find(function(t){return e===t.name}).genres.find(function(e){return t===e.name}).unseen=n.count}))})})})})}(i,c),function(e){e.forEach(function(e){return tt("tags=".concat(e.label,"&limit=0"),n).then(function(t){return h(Object(Re.a)(function(n){n.tags.find(function(t){return e.label===t.name}).count+=t.count}))})})}(s)},[i,c,s]),o.a.createElement("div",{className:"d-flex justify-content-around flex-wrap mb-4"},f.types.map(function(e,t){return o.a.createElement("div",{className:"card stat-card",key:t},o.a.createElement("div",{className:"card-body"},o.a.createElement("h5",{className:"card-title text-center"},e.count," ",e.name),o.a.createElement("div",null,et()(e.genres,["count"],["desc"]).map(function(t,n){return o.a.createElement(r.Fragment,{key:n},o.a.createElement("div",null," ",t.count," ",t.name," ("," ",t.count?(100*t.seen/t.count).toFixed(2):0,"% seen)"," "),o.a.createElement("div",{className:"movie-progress"},o.a.createElement("div",{className:"progress-bar unseen",role:"progressbar",style:{width:"calc(20px + ".concat(100*t.unseen/et()(e.genres,["count"],["desc"])[0].count,"%)")}},t.unseen),t.count-t.unseen-t.seen?o.a.createElement("div",{className:"progress-bar pending",role:"progressbar",style:{width:"calc(20px + ".concat(100*(t.count-t.unseen-t.seen)/et()(e.genres,["count"],["desc"])[0].count,"%)")}},t.count-t.unseen-t.seen):void 0,o.a.createElement("div",{className:"progress-bar seen",role:"progressbar",style:{width:"calc(20px + ".concat(100*t.seen/et()(e.genres,["count"],["desc"])[0].count,"%)")}},t.seen)))}))))}),o.a.createElement("div",{className:"card stat-card stat-tags-card"},o.a.createElement("div",{className:"card-body align-content-center"},f.tags.map(function(e,n){return o.a.createElement("h5",{className:"text-center stat-tags-card-card mt-1",style:{cursor:"pointer"},key:n,onClick:function(){u(),m("tags")([e.name]),t.push("/")}},o.a.createElement(z,{label:"".concat(e.count," ").concat(e.name),color:e.color}))}))))}),rt=(n(194),function(e){return Math.floor(Math.random()*Math.floor(e))}),ot=function(){return"#".concat(rt(256).toString(16).padStart(2,"0")).concat(rt(256).toString(16).padStart(2,"0")).concat(rt(256).toString(16).padStart(2,"0"))},ct=function(){var e=Object(r.useContext)(A),t=Object(r.useContext)(L),n=t.tags,a=(0,t.set)("tags"),c=Ue(ot()),i=Object(v.a)(c,2),s=i[0],l=i[1],u=Ue(""),m=Object(v.a)(u,2),d=m[0],p=m[1];return o.a.createElement("div",{className:"container tags-card"},n.map(function(t){return o.a.createElement("div",{key:t._id,className:"mt-2 mb-2 d-flex",style:{overflow:"hidden"}},o.a.createElement("div",null,o.a.createElement(z,Object.assign({},t,{big:!0}))),o.a.createElement("button",{type:"button",className:"btn btn-danger ml-2",onClick:function(n){n.preventDefault(),n.stopPropagation(),window.confirm("Delete tag ?")&&function(e,t){return fetch("/api/tags/".concat(e._id),{method:"DELETE",headers:B(t)}).then(Y)}(t,e).then(function(e){return a(function(e){return e.filter(function(e){return e._id!==t._id})})})}},o.a.createElement("i",{className:"fas fa-times"})))}),o.a.createElement("form",{className:"form-inline"},o.a.createElement("input",Object.assign({type:"color",className:"form-control colorpicker"},s)),o.a.createElement("input",Object.assign({type:"text",className:"form-control ml-2",placeholder:"Label"},d)),o.a.createElement("button",{type:"button",className:"btn btn-info btn-sm ml-2",onClick:function(){l(ot())}},o.a.createElement("i",{className:"fas fa-sync-alt"})),o.a.createElement("button",{type:"button",className:"btn btn-primary btn-sm ml-2",onClick:function(){(function(e,t){return fetch("/api/tags",{method:"POST",body:JSON.stringify(e),headers:B(t)}).then(Y)})({label:d.value,color:s.value},e).then(function(e){return a(function(t){return Object(V.a)(t).concat([e])})}).then(function(e){l(ot()),p("")})},disabled:!d.value||n.find(function(e){return e.label.toLowerCase()===d.value.toLowerCase()})},o.a.createElement("i",{className:"fas fa-check"})),o.a.createElement(z,{style:{marginLeft:"auto"},color:s.value,label:d.value||"Label"})))},it=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(r.Fragment,null,o.a.createElement(p.a,null,o.a.createElement(r.Fragment,null,o.a.createElement(Qe,null),o.a.createElement(f.a,{exact:!0,path:"/",component:_e}),o.a.createElement(f.a,{exact:!0,path:"/movie/:id",component:$e}),o.a.createElement(f.a,{exact:!0,path:"/stats",component:at}),o.a.createElement(f.a,{exact:!0,path:"/admin",component:ct}))))}}]),t}(r.Component),st=F(function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={password:""},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,this.props.user.status===_?o.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Login failed"):void 0,o.a.createElement("div",{className:"form-group"},o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"text",className:"form-control",id:"password","aria-describedby":"password",placeholder:"Enter password",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},onKeyDown:function(t){"Enter"===t.key&&e.props.user.login(e.state.password)}})),o.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return e.props.user.login(e.state.password)}},"Submit"))}}]),t}(r.Component));i.a.render(o.a.createElement(R,null,o.a.createElement(A.Consumer,null,function(e){var t=e.token;return t?o.a.createElement(U,{token:t},o.a.createElement(Z,null,o.a.createElement(it,null))):o.a.createElement(st,null)})),document.getElementById("root"))},83:function(e,t,n){e.exports=n(196)},88:function(e,t,n){},90:function(e,t,n){},92:function(e,t,n){}},[[83,2,1]]]);
//# sourceMappingURL=main.a6b1395c.chunk.js.map